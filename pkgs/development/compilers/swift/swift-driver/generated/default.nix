# This file was generated by swiftpm2nix.
{ lib, fetchgit }: rec {
  sources = {
    "swift-argument-parser" = fetchgit {
      url = "https://github.com/apple/swift-argument-parser.git";
      rev = "e1465042f195f374b94f915ba8ca49de24300a0d";
      sha256 = "11did5snqj8chcbdbiyx84mpif940ls2pr1iikwivvfp63i248hm";
    };
    "swift-llbuild" = fetchgit {
      url = "https://github.com/apple/swift-llbuild.git";
      rev = "564424db5fdb62dcb5d863bdf7212500ef03a87b";
      sha256 = "07zbp2dyfqd1bnyg7snpr9brn40jf22ivly5v10mql3hrg76a18h";
    };
    "swift-system" = fetchgit {
      url = "https://github.com/apple/swift-system.git";
      rev = "836bc4557b74fe6d2660218d56e3ce96aff76574";
      sha256 = "0402hkx2q2dv27gccnn8ma79ngvwiwzkhcv4zlcdldmy6cgi0px7";
    };
    "swift-tools-support-core" = fetchgit {
      url = "https://github.com/apple/swift-tools-support-core.git";
      rev = "184eba382f6abbb362ffc02942d790ff35019ad4";
      sha256 = "005akmisnkcg6zjwm545183c12xm8z504yxxqmnqf0rakfcab1mi";
    };
    "Yams" = fetchgit {
      url = "https://github.com/jpsim/Yams.git";
      rev = "9ff1cc9327586db4e0c8f46f064b6a82ec1566fa";
      sha256 = "1893y13sis2aimi1a5kgkczbf06z4yig054xb565yg2xm13srb45";
    };
  };
  configure = ''
    mkdir -p .build/checkouts
    ln -sf ${./Package.resolved} ./Package.resolved
    install -m 0600 ${./workspace-state.json} ./.build/workspace-state.json
  ''
    + lib.concatStrings (lib.mapAttrsToList (name: src: ''
      ln -s '${src}' '.build/checkouts/${name}'
    '') sources)
    + ''
      # Helper that makes a swiftpm dependency mutable by copying the source.
      swiftpmMakeMutable() {
        local orig="$(readlink .build/checkouts/$1)"
        rm .build/checkouts/$1
        cp -r "$orig" .build/checkouts/$1
        chmod -R u+w .build/checkouts/$1
      }
    '';
}
